@startuml SD_05_Ubah_Password
' ============================================================================
' SEQUENCE DIAGRAM - UBAH PASSWORD
' ============================================================================
' Use Case: Kelola Profil
' Aktor: Semua pengguna
' ============================================================================

skinparam backgroundColor #FEFEFE
skinparam shadowing false
skinparam defaultFontName "Segoe UI"
skinparam defaultFontSize 10

skinparam sequence {
    ArrowColor #455A64
    ArrowFontColor #37474F
    LifeLineBorderColor #78909C
    LifeLineBackgroundColor #ECEFF1
    ParticipantBorderColor #37474F
    ParticipantBackgroundColor #FFFFFF
    ActorBorderColor #1976D2
    ActorBackgroundColor #E3F2FD
    BoxBorderColor #9E9E9E
    BoxBackgroundColor #FAFAFA
}

autonumber

title **SD-05: Ubah Password**

actor "Semua\nPengguna" as USER

box "Application Layer" #E8F5E9
    participant "UserController" as UC
end box

box "Data Layer" #FFF3E0
    participant "User Model" as UM
    database "MySQL" as DB
end box

== Tampilkan Form ==

USER -> UC : GET /profile/change-password
activate UC
UC --> USER : Form ubah password
deactivate UC

== Proses Ubah Password ==

USER -> UC : POST /profile/change-password\n(password_lama, password_baru,\nkonfirmasi)
activate UC

UC -> UC : validate()

UC -> UM : Auth::user()
activate UM
UM --> UC : User object
deactivate UM

UC -> UC : Hash::check(password_lama)

alt Password lama salah
    UC --> USER : Error: "Password lama tidak sesuai"
else Password lama benar
    alt Password baru terlalu pendek
        UC --> USER : Error: "Password minimal 6 karakter"
    else Password valid
        UC -> UM : update password
        activate UM
        UM -> DB : UPDATE users SET\npassword = ?,\npassword_changed_at = NOW()
        DB --> UM : Updated
        UM --> UC : Success
        deactivate UM
        
        UC --> USER : Redirect /profile\nFlash: "Password berhasil diubah"
    end
end
deactivate UC

@enduml
