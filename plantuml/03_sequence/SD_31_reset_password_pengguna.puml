@startuml SD_31_Reset_Password_Pengguna
' ============================================================================
' SEQUENCE DIAGRAM - RESET PASSWORD PENGGUNA
' ============================================================================
' Use Case: Kelola Pengguna
' Aktor: Operator Sekolah
' ============================================================================

skinparam backgroundColor #FEFEFE
skinparam shadowing false
skinparam defaultFontName "Segoe UI"
skinparam defaultFontSize 10

skinparam sequence {
    ArrowColor #455A64
    ArrowFontColor #37474F
    LifeLineBorderColor #78909C
    LifeLineBackgroundColor #ECEFF1
    ParticipantBorderColor #37474F
    ParticipantBackgroundColor #FFFFFF
    ActorBorderColor #1976D2
    ActorBackgroundColor #E3F2FD
    BoxBorderColor #9E9E9E
    BoxBackgroundColor #FAFAFA
}

autonumber

title **SD-31: Reset Password Pengguna**

actor "Operator\nSekolah" as OPERATOR

box "Application Layer" #E8F5E9
    participant "UserController" as UC
end box

box "Data Layer" #FFF3E0
    participant "User Model" as UM
    database "MySQL" as DB
end box

== Tampilkan Form Reset ==

OPERATOR -> UC : GET /users/id/reset-password
activate UC

UC -> UM : findOrFail(id)
activate UM
UM -> DB : SELECT * FROM users WHERE id = ?
DB --> UM : User data
UM --> UC : User object
deactivate UM

UC --> OPERATOR : Form reset password:\n- User: nama_user\n- Password Baru\n- Konfirmasi Password
deactivate UC

== Proses Reset ==

OPERATOR -> UC : POST /users/id/reset-password\n(password, password_confirmation)
activate UC

UC -> UC : validate(password min:6, confirmed)

UC -> UM : findOrFail(id)->update()
activate UM
UM -> DB : UPDATE users SET\npassword = Hash(password),\npassword_changed_at = NULL
DB --> UM : Updated
UM --> UC : Success
deactivate UM

note right of UM
  password_changed_at = NULL
  agar user diminta ubah password
  saat login berikutnya
end note

UC --> OPERATOR : Redirect /users\nFlash: "Password berhasil di-reset.\nUser akan diminta ubah password\nsaat login berikutnya."
deactivate UC

@enduml
